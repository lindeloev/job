<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Run Code as an RStudio Job - Free Your Console • job</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><!-- docsearch --><script src="docsearch.js"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.3/docsearch.min.css" integrity="sha256-QOSRU/ra9ActyXkIBbiIB144aDBdtvXBcNc3OTNuX/Q=" crossorigin="anonymous">
<link href="docsearch.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script><link href="extra.css" rel="stylesheet">
<meta property="og:title" content="Run Code as an RStudio Job - Free Your Console">
<meta property="og:description" content="Call `job::job({&lt;code here&gt;})` to run R code as an RStudio job and keep your console free in the meantime. This is useful for testing long-running chunks of code, to organize results using the Jobs GUI, or to test code in a clean environment. Two RStudio Addins can be used to run selected code as a job.">
<meta name="twitter:card" content="summary">
<meta name="twitter:creator" content="@jonaslindeloev">
<meta name="twitter:site" content="@jonaslindeloev">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-1026978-3"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-1026978-3');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">job</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Usage and cases
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/articles/import.html">Controlling import</a>
    </li>
    <li>
      <a href="articles/articles/export.html">Controlling export</a>
    </li>
    <li>
      <a href="articles/articles/robust.html">Error robustness</a>
    </li>
    <li>
      <a href="articles/articles/testing.html">Case: Testing code</a>
    </li>
    <li>
      <a href="articles/articles/plot.html">Case: Rendering large plots</a>
    </li>
    <li>
      <a href="articles/articles/routines.html">Other routine tasks</a>
    </li>
  </ul>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">News</a>
</li>
<li>
  <a href="https://twitter.com/jonaslindeloev">
    <span class="fab fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/lindeloev/job">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
<form class="navbar-form navbar-right hidden-xs hidden-sm" role="search">
        <div class="form-group">
          <input type="search" class="form-control" name="search-input" id="search-input" placeholder="Search..." aria-label="Search for..." autocomplete="off">
</div>
      </form>
      
    </div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">


<div id="job-free-your-rstudio-console" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#job-free-your-rstudio-console" class="anchor"></a>job: free your RStudio console</h1></div>
<p>Use <code><a href="reference/job.html">job::job()</a></code> to run chunks of R code in an <a href="https://www.rstudio.com/">RStudio</a> job instead of the console. This frees your console while the job(s) go brrrrr in the background. By default, the result is returned to the global environment when the job completes.</p>
<p>Install:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">remotes</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html">install_github</a></span><span class="op">(</span><span class="st">"lindeloev/job"</span><span class="op">)</span></code></pre></div>
<div id="addins" class="section level2">
<h2 class="hasAnchor">
<a href="#addins" class="anchor"></a>Addins</h2>
<p>Two <a href="https://rstudio.github.io/rstudioaddins/">RStudio Addins</a> are installed with <code>job</code>. Simply select some code code in your editor and click one of the Addins to run it as a job. The results are returned to the global environment once the job completes.</p>
<p><img src="https://raw.githubusercontent.com/lindeloev/job/master/man/figures/addins.png"></p>
<ul>
<li>
<em>“Run selection as job”</em> imports everything from your environment, so it feels like home. It returns all variables that have been created or changed value during the job.</li>
<li>
<em>“Run selection as job in empty session”</em> imports nothing from your environment, so the code can run in clean isolation from the mess of a long-running session. All variables are returned.</li>
</ul>
</div>
<div id="typical-usage" class="section level2">
<h2 class="hasAnchor">
<a href="#typical-usage" class="anchor"></a>Typical usage</h2>
<p>Write your script as usual. Then wrap parts of it using <code>job::job({&lt;your code&gt;})</code> to run that chunk as a job:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">job</span><span class="fu">::</span><span class="fu"><a href="reference/job.html">job</a></span><span class="op">(</span><span class="op">{</span>
  <span class="va">foo</span> <span class="op">=</span> <span class="fl">10</span>
  <span class="va">bar</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span></code></pre></div>
<p>When the job completes, it silently saves <code>foo</code> and <code>bar</code> to your global environment.</p>
<p>Another use case: We all love <code>brms</code> but compilation and sampling takes time. Let’s run it as a job!</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms">brms</a></span><span class="op">)</span>
<span class="va">data</span> <span class="op">=</span> <span class="va">mtcars</span><span class="op">[</span><span class="va">mtcars</span><span class="op">$</span><span class="va">hp</span> <span class="op">&gt;</span> <span class="fl">100</span>, <span class="op">]</span>
<span class="va">model</span> <span class="op">=</span> <span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span> <span class="op">*</span> <span class="va">wt</span>

<span class="co"># Send long-running code to a job</span>
<span class="fu">job</span><span class="fu">::</span><span class="fu"><a href="reference/job.html">job</a></span><span class="op">(</span>brm_result <span class="op">=</span> <span class="op">{</span>
  <span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html">brm</a></span><span class="op">(</span><span class="va">model</span>, <span class="va">data</span><span class="op">)</span>
  <span class="va">fit</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/add_criterion.html">add_criterion</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"loo"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Show a summary in the job</span>
  <span class="va">the_test</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/hypothesis.brmsfit.html">hypothesis</a></span><span class="op">(</span><span class="va">fit</span>, <span class="st">"hp &gt; 0"</span><span class="op">)</span>
<span class="op">}</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"I'm free now! Thank you.
    Sincerely, Console."</span><span class="op">)</span></code></pre></div>
<p>Now you can follow the progress in the jobs pane and your console is free. Because we named the code block <code>brm_result</code>, it will return the contents as an <code><a href="https://rdrr.io/r/base/environment.html">environment()</a></code> called <code>brm_result</code> (or whatever you called it).<code>brm_result</code> behaves much like a <code><a href="https://rdrr.io/r/base/list.html">list()</a></code>:</p>
<p><img src="https://raw.githubusercontent.com/lindeloev/job/master/man/figures/return_environment.png"></p>
</div>
<div id="turn-rstudios-jobs-into-high-level-history" class="section level2">
<h2 class="hasAnchor">
<a href="#turn-rstudios-jobs-into-high-level-history" class="anchor"></a>Turn RStudio’s Jobs into high-level history</h2>
<p>Often, the results of the long-running chunks are the most interesting. But they easily get buried among the other outputs in the console and are eventually lost due to the line limit. RStudio’s jobs history can be used as a nice overview. Make sure to print informative results within the job and give your jobs an appropriate <code>title</code>, e.g., (<code>job::job({&lt;code here&gt;}, title = "Unit test: first attempt at feature X")</code>.</p>
<p><img src="https://raw.githubusercontent.com/lindeloev/job/master/man/figures/joblist.png"></p>
</div>
<div id="finer-control" class="section level2">
<h2 class="hasAnchor">
<a href="#finer-control" class="anchor"></a>Finer control</h2>
<p>RStudio jobs spin up a new session, i.e., a new environment. By default, <code><a href="reference/job.html">job::job()</a></code> will make this environment identical to your current one. But you can fine control this:</p>
<ul>
<li><p><code>import</code>: By default, everything is imported to the job (<code>import = "all")</code>. Use <code>import = "auto"</code> to only imports objects that are mentioned in the code chunk. Do specific imports with <code><a href="reference/job.html">job::job({}, import = c(model, data))</a></code>. Import nothing using <code>import = NULL</code>.</p></li>
<li><p><code>packages</code>: By default, all attached packages are attached in the job. Control this using <code><a href="reference/job.html">job::job({}, packages = c("brms"))</a></code> or set <code>packages = NULL</code> to load nothing. If <code>brms</code> is not loaded in your current session, adding <code><a href="https://github.com/paul-buerkner/brms">library("brms")</a></code> to the job code may be more readable.</p></li>
<li><p><code>options</code>: By default, all options are overwritten/inserted to the job. Control this using, e.g., <code>job::job({}, opts = list(mc.cores = 2)</code> or set <code>opts = NULL</code> to use default options. If you want to set job-specific options, adding <code><a href="https://rdrr.io/r/base/options.html">options(mc.cores = 2)</a></code> to the job code may be more readable.</p></li>
<li><p><code><a href="reference/export.html">job::export()</a></code>: Call this function as the last line in your code chunk to control what gets returned. <code><a href="reference/export.html">export("changed")</a></code> is default but <code><a href="reference/export.html">export("all")</a></code> and <code><a href="reference/export.html">export(NULL)</a></code> can be useful too. See <code><a href="reference/export.html">?export</a></code> for more info and examples.</p></li>
<li>
<p>Returned result: In the example above, we assigned the job environment to <code>brm_result</code> upon completion. Naturally, you can choose any name, e.g., <code><a href="reference/job.html">job::job(fancy_name = {a = 5})</a></code>. To return nothing, use an unnamed code chunk (insert results to <code><a href="https://rdrr.io/r/base/environment.html">globalenv()</a></code> and remove everything before return: (<code><a href="reference/job.html">job::job({a = 5; rm(list=ls())})</a></code>. Returning nothing is useful when</p>
<ol>
<li><p>your main result is a text output or a file on the disk, or</p></li>
<li><p>when the return is a very large object. The underlying <code><a href="https://rdrr.io/pkg/rstudioapi/man/jobRunScript.html">rstudioapi::jobRunScript()</a></code> is slow in the back-transfer so it’s usually faster to <code><a href="https://rdrr.io/r/base/readRDS.html">saveRDS(obj, filename)</a></code> them in the job and <code><a href="https://rdrr.io/r/base/readRDS.html">readRDS(filename)</a></code> into your current session.</p></li>
</ol>
</li>
</ul>
</div>
<div id="some-use-cases" class="section level2">
<h2 class="hasAnchor">
<a href="#some-use-cases" class="anchor"></a>Some use cases</h2>
<ul>
<li>Model training, cross validation, or hyperparameter tuning: train multiple models simultaneously, each in their own job. If one fails, the others continue.</li>
<li>Heavy I/O tasks, like processing large files. Save the results to disk and return nothing.</li>
<li>Run unit tests and other code in an empty environment. By default, <code><a href="https://devtools.r-lib.org//reference/test.html">devtools::test()</a></code> runs in the current environment, including manually defined variables (e.g., from the last test-run) and attached packages. Call <code><a href="reference/job.html">job::job({devtools::test()}, import = NULL, packages = NULL, opts = NULL)</a></code> to run the test in complete isolation.</li>
<li>Upgrading packages</li>
</ul>
</div>
<div id="see-also" class="section level2">
<h2 class="hasAnchor">
<a href="#see-also" class="anchor"></a>See also</h2>
<p><code><a href="reference/job.html">job::job()</a></code> is aimed at easing interactive development within RStudio. For larger problems, production code, and solutions that work outside of RStudio, check out:</p>
<ul>
<li><p>The <a href="https://cran.r-project.org/web/packages/future/vignettes/future-1-overview.html"><code>future</code> package</a>’s <code>%&lt;-</code> operator combined with <code>plan(multisession)</code>.</p></li>
<li><p>The <a href="https://callr.r-lib.org/"><code>callr</code> package</a> is a general tool to run code in new R sessions.</p></li>
</ul>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="http://lindeloev.net">Jonas Kristoffer Lindeløv</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-4565-0595" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=job"><img src="https://www.r-pkg.org/badges/version/job" alt="CRAN status"></a></li>
<li><a href="https://github.com/lindeloev/job/actions"><img src="https://github.com/lindeloev/job/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://lindeloev.net">Jonas Kristoffer Lindeløv</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  
<script src="https://cdnjs.cloudflare.com/ajax/libs/docsearch.js/2.6.1/docsearch.min.js" integrity="sha256-GKvGqXDznoRYHCwKXGnuchvKSwmx9SRMrZOTh2g4Sb0=" crossorigin="anonymous"></script><script>
  docsearch({
    
    
    apiKey: '702ab134d40a7310606c29f341fc5014',
    indexName: 'lindeloev_job',
    inputSelector: 'input#search-input.form-control',
    transformData: function(hits) {
      return hits.map(function (hit) {
        hit.url = updateHitURL(hit);
        return hit;
      });
    }
  });
</script>
</body>
</html>
